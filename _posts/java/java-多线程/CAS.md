---
layout: article
title: CAS详解JAVA
mathjax: true
tags: Java CAS
key: 2019-01-01
categories:
- 多线程
- CAS


---



# 名词解释

CAS就是compare and swap的缩写，比较并交换。

CAS 操作包含三个操作数 —— 内存位置（V）、预期原值（A）和新值(B)



# CAS解释

![image-20201117172241035](https://tyninganother.github.io/assets/image-20201117172241035.png)



读取当前值E=0然后计算比如加1，然后将1在写回到E的时候比较一下E中存放的值是否是原来的0，如果是就将E改写成1，否则（比如E已经变成3）再重新读一次，是3，然后在计算加1，然后将新值4写回到E的时候再比较E是否是之前取出来的值3如果是就写入，不停的重复这样的过程指导写入成功。这就是CAS的全过程。

# ABA问题

1.什么是ABA问题

就是读取当前值E=0然后计算比如加1，然后将1在写回到E的时候虽然E还是等于0。但是，其他线程可能已经将E的0改成其他值然后又改回了0。

2.如何解决ABA问题呢？

可以给E中的值添加版本号，每次读的时候将值和版本号都拿出来，做完计算之后在写入的时候除了比较E中的值之外还要比较一下版本号。